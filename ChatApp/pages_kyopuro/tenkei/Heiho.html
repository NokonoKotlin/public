<!doctype html>
<html lang="ja">
    <link rel="stylesheet" media="screen and (max-width:768px)" href="./../../css/sp_style.css">    
    <link rel="stylesheet" media="screen and (min-width:769px)" href="./../../css/pc_style.css">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    </script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" }},
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
        },
        "HTML-CSS": { matchFontHeight: false },
        displayAlign: "left",
        displayIndent: "2em"
    });
    </script>
    <title>クエリ平方分割</title>
        

    </head>




    <body>
        
         <!--軽くコメント-->
        <div id="Inner">
            <h_middle style = "text-align: left;"><a href="../../index.html">前のページ</a> </h_middle>
            <section class = "Introduction">
                
                <h_big>   
                    クエリ平方分割<br></h_big>


            </section>


            <section class = "Explanation">
               
                <br>
                <br>クエリ平方分割は、Q 個のクエリに答えるときに使えるアルゴリズムです。
                <br>
                <br>使用できる場面は以下の場合です。
                <br>&ensp;&ensp;① : クエリが √Q 回ごとに O( N ) あたりで情報を更新できる
                <br>&ensp;&ensp;② : 各クエリに答えるとき、最後の①の操作以降のクエリの情報を見ながらクエリの計算ができる
                <br>
                
                
                <br>①の操作は、O( N ) の操作を √Q 回行うので、O( N√Q ) です。
                <br>②の操作は、最後の①以降のクエリは高々√Q 個であることから、O( Q√Q ) です。
                <br>
                <br>
                <br>例題として、<a href = >こちらの問題</a>を解きました。以下はソースコードになります。
                <br>
                <br>
                
                <br>
                <br>
                <br>

                <code>
                    <ol style="list-style:decimal-leading-zero outside;in-left:0;padding-left:36px;margin:0;background-color:#EEF;width:90%;line-height: 14px; color:#000;font-size:12px;">
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//include</font></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//------------------------------------------</font></li>
                    <li style="background-color:#EFF;">#include &lt;vector&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;list&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;map&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;set&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;deque&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;stack&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;bitset&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;algorithm&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;functional&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;numeric&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;utility&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;sstream&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;iostream&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;iomanip&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;cstdio&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;cmath&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;cstdlib&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;cctype&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;string&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;cstring&gt;</li>
                    <li style="background-color:#EFF;">#include &lt;ctime&gt;</li>
                    <li style="background-color:#EEF;">#include&lt;queue&gt;</li>
                    <li style="background-color:#EFF;">#include&lt;complex&gt;</li>
                    <li style="background-color:#EEF;">#include &lt;cassert&gt;</li>
                    <li style="background-color:#EFF;">using namespace std;</li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//conversion</font></li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//------------------------------------------</font></li>
                    <li style="background-color:#EEF;">inline long long toint(string s) {long long v; istringstream sin(s);sin&gt;&gt;v;return v;}</li>
                    <li style="background-color:#EFF;">template&lt;class T&gt; inline string toString(T x) {ostringstream sout;sout&lt;&lt;x;return sout.str();}</li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//math</font></li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//-------------------------------------------</font></li>
                    <li style="background-color:#EEF;">template&lt;class T&gt; inline T sqr(T x) {return x*x;}</li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//typedef</font></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//------------------------------------------</font></li>
                    <li style="background-color:#EFF;">typedef long long ll;</li>
                    <li style="background-color:#EEF;">typedef long long LL;</li>
                    <li style="background-color:#EFF;">typedef vector&lt;int &gt; vi;</li>
                    <li style="background-color:#EEF;">typedef vector&lt;long long &gt; VLL;</li>
                    <li style="background-color:#EFF;">typedef vector&lt;long long &gt; vll;</li>
                    <li style="background-color:#EEF;">typedef vector&lt;string &gt; ves;</li>
                    <li style="background-color:#EFF;">typedef vector&lt;char &gt; vech;</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;">typedef pair&lt;long long , long long&gt; pll;</li>
                    <li style="background-color:#EEF;">typedef pair&lt;long long , long long&gt; PLL;</li>
                    <li style="background-color:#EFF;">typedef map&lt;ll , ll &gt;mll;</li>
                    <li style="background-color:#EEF;">typedef map&lt;int , int &gt;mii;</li>
                    <li style="background-color:#EFF;">typedef map&lt;char , int &gt;mci;</li>
                    <li style="background-color:#EEF;">typedef map&lt;char , ll &gt;mcl;</li>
                    <li style="background-color:#EFF;">typedef vector&lt;pair&lt;ll , ll&gt; &gt; vpll;</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//container util</font></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//------------------------------------------</font></li>
                    <li style="background-color:#EFF;">#define ALL(a)  (a).begin(),(a).end()</li>
                    <li style="background-color:#EEF;">#define RALL(a) (a).rbegin(), (a).rend()</li>
                    <li style="background-color:#EFF;">#define VECMAX(x) *max_element(ALL(x))</li>
                    <li style="background-color:#EEF;">#define VECMIN(x) *min_element(ALL(x))</li>
                    <li style="background-color:#EFF;">#define PB push_back</li>
                    <li style="background-color:#EEF;">#define MP make_pair</li>
                    <li style="background-color:#EFF;">#define SZ(a) int((a).size())</li>
                    <li style="background-color:#EEF;">#define EACH(i,c) for(typeof((c).begin()) i=(c).begin(); i!=(c).end(); ++i)</li>
                    <li style="background-color:#EFF;">#define EXIST(s,e) ((s).find(e)!=(s).end())</li>
                    <li style="background-color:#EEF;">#define SORT(c) sort((c).begin(),(c).end())</li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//repetition</font></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//------------------------------------------</font></li>
                    <li style="background-color:#EFF;">#define FOR(i,a,b) for(long long i=(a);i&lt;(b);++i)</li>
                    <li style="background-color:#EEF;">#define REP(i,n)  FOR(i,0,n)</li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//#define MULTIPLE(i,n,k) for(int i = (k) ; i&lt;(n) ; i+=k+1)//倍数ループ</font></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//constant</font></li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">//------------------------------------------</font></li>
                    <li style="background-color:#EEF;">const double EPS = 1e-10;</li>
                    <li style="background-color:#EFF;">const double PI  = acos(-1.0);</li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//clear memory</font></li>
                    <li style="background-color:#EFF;">#define CLR(a) memset((a), 0 ,sizeof(a))</li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//debug</font></li>
                    <li style="background-color:#EFF;">#define dump(x)  cerr &lt;&lt; #x &lt;&lt; <font style="color:brown;">" = "</font> &lt;&lt; (x) &lt;&lt; endl;</li>
                    <li style="background-color:#EEF;">#define debug(x) cerr &lt;&lt; #x &lt;&lt; <font style="color:brown;">" = "</font> &lt;&lt; (x) &lt;&lt; <font style="color:brown;">" (L"</font> &lt;&lt; __LINE__ &lt;&lt; <font style="color:brown;">")"</font> &lt;&lt; <font style="color:brown;">" "</font> &lt;&lt; __FILE__ &lt;&lt; endl;</li>
                    <li style="background-color:#EFF;">#define SIZEOF(x) sizeof(x)/sizeof(x[0])</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;">const long long INF = 4e18;</li>
                    <li style="background-color:#EFF;">const long long NINF = 1 - INF;</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;">#define ENDL cout &lt;&lt; endl;</li>
                    <li style="background-color:#EEF;">#define CIN(a) REP(i,a.size())cin &gt;&gt; a[i];</li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//二次元座標の点を表す構造体。xとyをメンバに持つ</font></li>
                    <li style="background-color:#EFF;">struct POINT{</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;double x;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;double y;</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;">};</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//最小公倍数、最大公約数</font></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;">ll gcd(ll x, ll y) { return y ? gcd(y, x % y) : x; }</li>
                    <li style="background-color:#EFF;">ll lcm(ll a, ll b) { return (a / gcd(a, b)) * b; }</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"><font style="color:green;font-style:italic;">/*</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;nCr , 値が大きいとオーバーフローする</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;n&lt;=kなら1 (0C1や1C5= 1)</li>
                    <li style="background-color:#EEF;">*/</font></li>
                    <li style="background-color:#EFF;">ll nCr(ll n,  ll r){</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;if ( r * 2 &gt; n ) r = n - r;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;ll dividend = 1;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;ll divisor  = 1;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;for ( unsigned int i = 1; i &lt;= r; ++i ) {</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;dividend *= (n-i+1);</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;divisor  *= i;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;}</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;return dividend / divisor;</li>
                    <li style="background-color:#EEF;">}</li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;">int main(){</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;int n,q;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;cin &gt;&gt; n &gt;&gt; q;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;vll a(n);</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;CIN(a);</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;vll r(n+1);</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;ll idnt = sqrt(q);</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;vector&lt;pll&gt; Q;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;REP(i,q){</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(i%idnt == 0){</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q = vpll(0);</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r[0] = 0;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REP(i,n)r[i+1] = r[i]^a[i];</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll t , x , y;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cin &gt;&gt; t &gt;&gt; x &gt;&gt; y;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(t == 1){</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q.push_back(MP(x,y));</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a[x-1] = a[x-1]^y;    </li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll ans = r[y]^r[x-1];</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(pll p : Q){</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(x &lt;= p.first &amp;&amp; p.first &lt;= y)ans^=p.second;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout &lt;&lt; ans &lt;&lt; endl;</li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;}</li>
                    <li style="background-color:#EEF;"></li>
                    <li style="background-color:#EFF;"></li>
                    <li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</li>
                    <li style="background-color:#EFF;">}</li>
                    </ol>
                </code>




                
            </section>



        </div>



    </body>


</html>
